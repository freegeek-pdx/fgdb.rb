#!/bin/sh

exec >>/var/log/rsync-to-xyzzy 2>>/var/log/rsync-to-xyzzy

echo
echo "====================================================================="
echo "Starting at $(date) with args: $@"
echo "====================================================================="
echo

PATH=$PATH:~/bin/
cd
wget http://dev.freegeek.org/~ryan52/devel_data/version -O /var/tmp/version.new
mkdir /tmp/rsync-to-xyzzy || { echo "rsync-to-xyzzy is already running"; exit 1; }
if [ "$?" != "0" ] || [ "$1" = "--force" -o "$1" = "-f" -o "$1" = "force" ] || [ ! -f /var/tmp/version ] || ! diff /var/tmp/version.new /var/tmp/version; then
    under-myagent rsync --progress --delete-excluded -azv dev.freegeek.org:public_html/devel_data/ devel_data/
    RETURN="$?"
fi
rmdir /tmp/rsync-to-xyzzy

echo
echo "====================================================================="
echo "Finished with $RETURN at $(date)"
echo "====================================================================="
echo

exit $RETURN
